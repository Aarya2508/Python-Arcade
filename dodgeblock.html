<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Neon Dodge Block</title>
  <style>
    :root{
      --bg:#000000; /* black */
      --c1:#fffd8d; /* soft red */
      --c2:#5cbbee; /* peach */
      --c3:#64fce7; /* lemon */
      --c4:#f56892; /* sky */
      --c5:#7c69e9; /* lavender */
      --grid:#121212;
      --cell:40px;
    }
    *{box-sizing:border-box;font-family:Inter, system-ui, -apple-system, 'Segoe UI', Roboto, Arial}
    html,body{height:100%;margin:0;background:var(--bg);color:#ddd}
    .wrap{display:flex;gap:20px;align-items:flex-start;justify-content:center;padding:24px}
    .panel{width:320px;padding:14px;border-radius:12px;background:linear-gradient(180deg, rgba(255,255,255,0.02), transparent);border:1px solid rgba(255,255,255,0.03)}
    .game{padding:14px;border-radius:12px;box-shadow:0 10px 40px rgba(0,0,0,0.7);}
    canvas{background:linear-gradient(180deg,var(--grid), #080808);border-radius:8px;display:block}
    h1{color:#fff;font-size:18px;margin:6px 0 12px;text-align:center}
    .controls{font-size:13px;color:#bbb;margin-top:8px;text-align:center}
    .btn{display:inline-block;padding:8px 12px;border-radius:10px;background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.03);cursor:pointer;margin-right:6px}
    .stat{display:flex;justify-content:space-between;padding:8px 10px;border-radius:8px;margin-bottom:8px;background:rgba(255,255,255,0.02);align-items:center}
    label{display:block;font-size:13px;color:#bbb;margin-top:8px}
    input[type=text], input[type=number]{width:100%;padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.03);background:transparent;color:#fff}
    .hs{max-height:200px;overflow:auto;padding:6px;background:linear-gradient(180deg, rgba(0,0,0,0.12), transparent);border-radius:8px}
    .hs-item{display:flex;justify-content:space-between;padding:6px 8px;border-radius:6px;margin-bottom:6px;background:linear-gradient(90deg, rgba(255,255,255,0.01), transparent)}
    footer{font-size:12px;color:#8f8f8f;text-align:center;margin-top:10px}
    @media (max-width:900px){.wrap{flex-direction:column;align-items:center}.panel{width:92%}}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="game">
      <h1>Neon Dodge Block</h1>
      <canvas id="game" width="400" height="640"></canvas>
      <div style="margin-top:10px;display:flex;gap:8px;align-items:center;justify-content:center">
        <div class="btn" id="start">Start</div>
        <div class="btn" id="pause">Pause</div>
        <div class="btn" id="reset">Reset</div>
      </div>
      <div class="controls">Move: ← → or A/D — Pause: P — Tap to move on mobile</div>
    </div>

    <div class="panel">
      <h1>Scoreboard</h1>
      <div class="stat"><span>Score</span><b id="score">0</b></div>
      <div class="stat"><span>Level</span><b id="level">1</b></div>
      <div class="stat"><span>Time</span><b id="time">0s</b></div>

      <label>Player name</label>
      <input type="text" id="name" placeholder="Type a name...">
      <label>Manual score</label>
      <input type="number" id="manual" placeholder="Enter score to add">
      <div style="margin-top:8px;display:flex;gap:8px"><div class="btn" id="add">Add score</div><div class="btn" id="clear">Clear</div></div>

      <h1 style="font-size:14px;margin-top:12px">High Scores</h1>
      <div class="hs" id="hs"></div>
      <footer>Created by Aarya, Nuha and Zuzu</footer>
    </div>
  </div>

  <script>
    const canvas = document.getElementById('game');
    const ctx = canvas.getContext('2d');
    const W = canvas.width, H = canvas.height;

    // colors from CSS variables
    const style = getComputedStyle(document.documentElement);
    const COLORS = [style.getPropertyValue('--c1').trim(), style.getPropertyValue('--c2').trim(), style.getPropertyValue('--c3').trim(), style.getPropertyValue('--c4').trim(), style.getPropertyValue('--c5').trim()];

    // player
    const player = {w:50, h:50, x: (W/2)-25, y: H - 80, speed:8, color: style.getPropertyValue('--c1').trim() };

    // obstacles array
    let obstacles = [];
    let spawnTimer = 0, spawnInterval = 800; // ms
    let gameLoop = null, started=false, paused=false;
    let score = 0, level=1, timeElapsed = 0, startTime = null;

    function randInt(a,b){ return Math.floor(Math.random()*(b-a+1))+a; }

    function reset(){ obstacles=[]; spawnTimer=0; score=0; level=1; timeElapsed=0; startTime=null; player.x=(W/2)-player.w/2; document.getElementById('score').textContent='0'; document.getElementById('level').textContent='1'; document.getElementById('time').textContent='0s'; }

    function start(){ if(started && !paused) return; started=true; paused=false; startTime = startTime || Date.now(); if(gameLoop) cancelAnimationFrame(gameLoop); loop(); }
    function togglePause(){ paused = !paused; if(!paused) loop(); }

    function spawnObstacle(){
      const w = randInt(40,120);
      const x = randInt(10, W - w -10);
      const speed = 2 + Math.random()* (1 + level*0.5);
      const color = COLORS[Math.floor(Math.random()*COLORS.length)];
      obstacles.push({x, y:-60, w, h: randInt(30,80), speed, color});
    }

    function update(dt){
      if(paused || !started) return;
      // spawn
      spawnTimer += dt;
      const localInterval = Math.max(250, spawnInterval - (level-1)*60);
      if(spawnTimer > localInterval){ spawnTimer = 0; spawnObstacle(); }

      // update obstacles
      for(let i=obstacles.length-1;i>=0;i--){
        obstacles[i].y += obstacles[i].speed * (dt/16);
        if(obstacles[i].y > H + 100) { obstacles.splice(i,1); score += 10; }
      }

      // collision
      for(const o of obstacles){ if(rectIntersect(player, o)) { gameOver(); return; } }

      // level from score
      level = Math.floor(score/200) + 1;
      document.getElementById('score').textContent = score;
      document.getElementById('level').textContent = level;
      timeElapsed = Math.floor((Date.now() - startTime)/1000);
      document.getElementById('time').textContent = timeElapsed + 's';
    }

    function rectIntersect(a,b){ return !(a.x + a.w < b.x || a.x > b.x + b.w || a.y + a.h < b.y || a.y > b.y + b.h); }

    function drawRoundedRect(x,y,w,h,r,ctx){ ctx.beginPath(); ctx.moveTo(x+r,y); ctx.arcTo(x+w,y,x+w,y+h,r); ctx.arcTo(x+w,y+h,x,y+h,r); ctx.arcTo(x,y+h,x,y,r); ctx.arcTo(x,y,x+w,y,r); ctx.closePath(); ctx.fill(); }

    function draw(){
      // background
      ctx.clearRect(0,0,W,H);
      // subtle grid
      ctx.fillStyle = '#040404'; ctx.fillRect(0,0,W,H);
      for(let gx=0;gx<W;gx+=40){ ctx.fillStyle = 'rgba(255,255,255,0.01)'; ctx.fillRect(gx,0,1,H); }

      // draw player with neon glow
      ctx.save(); ctx.shadowBlur=24; ctx.shadowColor = player.color; ctx.fillStyle = player.color; drawRoundedRect(player.x, player.y, player.w, player.h, 8, ctx); ctx.restore();
      // player gloss
      ctx.save(); ctx.globalAlpha = 0.12; ctx.fillStyle = '#fff'; ctx.fillRect(player.x+8, player.y+6, player.w-16, 12); ctx.restore();

      // obstacles
      for(const o of obstacles){ ctx.save(); ctx.shadowBlur=20; ctx.shadowColor=o.color; ctx.fillStyle = o.color; drawRoundedRect(o.x, o.y, o.w, o.h, 6, ctx); ctx.restore(); }

      // HUD
      ctx.fillStyle = 'rgba(255,255,255,0.04)'; ctx.fillRect(8,8,110,40); ctx.fillStyle='#fff'; ctx.font='12px Inter, Arial'; ctx.fillText('Score: '+score, 14, 26);
    }

    let last = performance.now();
    function loop(ts){
      gameLoop = requestAnimationFrame(loop);
      const dt = ts - last; last = ts;
      if(!paused && started){ update(dt); }
      draw();
    }

    function gameOver(){
      paused = true; started = false; cancelAnimationFrame(gameLoop);
      // save to highscore automatically
      saveHS(prompt('Game Over — enter name to save score','') || 'Player');
      alert('Game Over — score: '+score);
    }

    // controls
    document.addEventListener('keydown', e=>{
      if(e.key === 'ArrowLeft' || e.key.toLowerCase() === 'a'){ player.x = Math.max(6, player.x - player.speed); }
      else if(e.key === 'ArrowRight' || e.key.toLowerCase() === 'd'){ player.x = Math.min(W - player.w -6, player.x + player.speed); }
      else if(e.key.toLowerCase() === 'p'){ togglePause(); }
    });

    // touch: tap left/right
    canvas.addEventListener('touchstart', e=>{
      const t = e.touches[0]; const rect = canvas.getBoundingClientRect(); const x = t.clientX - rect.left;
      if(x < W/2) player.x = Math.max(6, player.x - player.speed*3); else player.x = Math.min(W - player.w -6, player.x + player.speed*3);
    });

    // mouse click also moves
    canvas.addEventListener('mousedown', e=>{ const rect = canvas.getBoundingClientRect(); const x = e.clientX - rect.left; if(x < W/2) player.x = Math.max(6, player.x - player.speed*3); else player.x = Math.min(W - player.w -6, player.x + player.speed*3); });

    // buttons
    document.getElementById('start').addEventListener('click', ()=>{ start(); });
    document.getElementById('pause').addEventListener('click', ()=>{ togglePause(); });
    document.getElementById('reset').addEventListener('click', ()=>{ reset(); draw(); });

    // high scores (manual add + auto-save)
    function loadHS(){ return JSON.parse(localStorage.getItem('neon_dodge_hs') || '[]'); }
    function renderHS(){ const box = document.getElementById('hs'); box.innerHTML=''; const hs = loadHS(); hs.sort((a,b)=>b.score-a.score).forEach(it=>{ const el = document.createElement('div'); el.className='hs-item'; el.innerHTML = `<div>${escapeHtml(it.name)}</div><div>${it.score}</div>`; box.appendChild(el); }); }
    function saveHS(name){ const hs = loadHS(); hs.push({name: name || document.getElementById('name').value || 'Player', score}); localStorage.setItem('neon_dodge_hs', JSON.stringify(hs)); renderHS(); }
    function escapeHtml(s){ return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }

    document.getElementById('add').addEventListener('click', ()=>{ const n = document.getElementById('name').value || 'Player'; const sc = parseInt(document.getElementById('manual').value) || 0; const hs = loadHS(); hs.push({name:n, score:sc}); localStorage.setItem('neon_dodge_hs', JSON.stringify(hs)); renderHS(); });
    document.getElementById('clear').addEventListener('click', ()=>{ localStorage.removeItem('neon_dodge_hs'); renderHS(); });

    // init
    reset(); renderHS(); draw();
  </script>
</body>
</html>
